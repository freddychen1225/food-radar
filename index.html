<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- ç¶²é æ¨™é¡Œ -->
    <title>ç¾é£Ÿé›·é” V3.5</title>

    <!-- SEO å„ªåŒ–è¨­å®š -->
    <meta name="description" content="ç¾é£Ÿé›·é” (Food Radar) æ˜¯ä¸€æ¬¾å…è²»çš„ Google Maps æ™ºæ…§æœå°‹å·¥å…·ã€‚è§£æ±ºã€Œä»Šå¤©åƒä»€éº¼ã€çš„ç…©æƒ±ï¼Œæä¾›éš¨æ©Ÿç¾é£Ÿæ¨è–¦ã€å¹³åƒ¹æ­£é¤æœå°‹åŠä¸‹åˆèŒ¶é»å¿ƒå»ºè­°ã€‚ä¸ç”¨ä¸‹è¼‰ Appï¼Œæ‰“é–‹ç¶²é å³å¯ä½¿ç”¨ï¼">
    <meta name="keywords" content="ç¾é£Ÿé›·é”, ä»Šå¤©åƒä»€éº¼, é™„è¿‘ç¾é£Ÿ, Google Maps æœå°‹, å¹³åƒ¹ç¾é£Ÿ, ä¸‹åˆèŒ¶æ¨è–¦, éš¨æ©Ÿé¸é¤å»³, è¦ªå­é¤å»³, å¯µç‰©å‹å–„">
    <meta name="author" content="Freddy">
    
    <!-- è¨­å®š Open Graph æ¨™ç±¤ -->
    <meta property="og:title" content="ç¾é£Ÿé›·é” V3.5 - ä»Šå¤©åƒä»€éº¼ï¼Ÿ">
    <meta property="og:description" content="ä¸ç”¨ä¸‹è¼‰ Appï¼Œæ‰“é–‹ç¶²é å³å¯ä½¿ç”¨ï¼éš¨æ©Ÿç¾é£Ÿæ¨è–¦ã€å¹³åƒ¹æ­£é¤æœå°‹ã€‚">
    <meta property="og:image" content="https://cdn-icons-png.flaticon.com/512/1046/1046747.png">
    <meta property="og:url" content="https://freddychen1225.github.io/food-radar/">

    <!-- Google Search Console é©—è­‰ -->
    <meta name="google-site-verification" content="NQhtyIlgmyy8RmQKDZDP-OYrJlMlkIsO3RromfSEclw" /> 
    
    <!-- === PWA è¨­å®š === -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ç¾é£Ÿé›·é”">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1046/1046747.png">
    <meta name="theme-color" content="#f7f9fc">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/1046/1046747.png">
    <link rel="manifest" href="manifest.json">

    <!-- å¼•å…¥ä¸è’œå­è¨ˆæ•¸å™¨ -->
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <style>
        :root {
            --primary-color: #ff6b6b; --secondary-color: #4ecdc4; --drink-color: #e67e22;
            --special-color: #6c5ce7; --random-color: #9b59b6; --bg-color: #f7f9fc; --text-color: #2d3436;
            --line-color: #06c755;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color); color: var(--text-color);
            margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; box-sizing: border-box; overscroll-behavior-y: none;
        }

        h1 { color: var(--primary-color); font-size: 1.8rem; margin-bottom: 10px; text-align: center; }
        .subtitle { color: #636e72; font-size: 0.9rem; margin-bottom: 20px; text-align: center; }

        .section-title {
            font-size: 1.1rem; font-weight: bold; align-self: flex-start; margin: 20px 0 10px 0;
            padding-left: 5px; border-left: 4px solid var(--primary-color); width: 100%; max-width: 600px;
        }

        .mode-switch {
            display: flex; background: white; border-radius: 15px; padding: 5px;
            width: 100%; max-width: 600px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 10px;
        }

        .mode-btn {
            flex: 1; border: none; background: transparent; padding: 12px 5px; font-size: 1.0rem;
            font-weight: bold; color: #aaa; cursor: pointer; border-radius: 10px; transition: all 0.3s;
            white-space: nowrap; -webkit-tap-highlight-color: transparent;
        }

        .mode-btn.active-meal { background-color: #fff0f0; color: var(--primary-color); box-shadow: 0 2px 5px rgba(255, 107, 107, 0.2); }
        .mode-btn.active-drink { background-color: #fff5e6; color: var(--drink-color); box-shadow: 0 2px 5px rgba(230, 126, 34, 0.2); }
        .mode-btn.active-special { background-color: #f0eeff; color: var(--special-color); box-shadow: 0 2px 5px rgba(108, 92, 231, 0.2); }

        .grid-container {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; max-width: 600px;
        }
        .grid-container.scenarios { grid-template-columns: repeat(2, 1fr); }

        .option-btn {
            background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 12px 5px;
            font-size: 0.95rem; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column;
            align-items: center; justify-content: center; min-height: 70px; -webkit-tap-highlight-color: transparent;
        }
        .option-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 10px rgba(0,0,0,0.1); }
        .option-btn.selected { border-color: var(--primary-color); background-color: #fff0f0; color: var(--primary-color); font-weight: bold; }
        .icon { font-size: 1.5rem; margin-bottom: 5px; }

        body.drink-mode .option-btn.selected { border-color: var(--drink-color); background-color: #fff5e6; color: var(--drink-color); }
        body.special-mode .option-btn.selected { border-color: var(--special-color); background-color: #f0eeff; color: var(--special-color); }
        
        #special-notice {
            display: none; text-align: center; font-size: 1.1rem; font-weight: bold;
            color: var(--special-color); margin-top: 25px; margin-bottom: 5px; line-height: 1.6; width: 100%; max-width: 600px;
        }
        body.special-mode #special-notice { display: block; }

        .action-area {
            display: flex; gap: 10px; width: 100%; max-width: 400px; margin-top: 15px;
        }

        .action-btn {
            border: none; border-radius: 50px; padding: 15px 0; font-size: 1.1rem; font-weight: bold;
            color: white; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 5px; -webkit-tap-highlight-color: transparent;
        }
        .action-btn:active { transform: scale(0.96); }

        #search-btn { flex: 2; background-color: var(--primary-color); box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4); }
        body.drink-mode #search-btn { background-color: var(--drink-color); box-shadow: 0 4px 15px rgba(230, 126, 34, 0.4); }
        body.special-mode #search-btn { background-color: var(--special-color); box-shadow: 0 4px 15px rgba(108, 92, 231, 0.4); }
        #random-btn { flex: 1.2; background-color: var(--random-color); box-shadow: 0 4px 15px rgba(155, 89, 182, 0.4); }
        body.special-mode #random-btn { display: none; }

        .counter-box {
            margin-top: 15px; font-size: 0.9rem; color: #888; text-align: center;
            background-color: rgba(255, 255, 255, 0.6); padding: 5px 15px; border-radius: 20px;
        }

        .footer {
            margin-top: auto; padding-top: 40px; padding-bottom: 20px; font-size: 1.0rem;
            color: #888; font-weight: bold; letter-spacing: 1px; text-align: center;
            display: flex; flex-direction: column; align-items: center; gap: 15px; width: 100%;
        }
        
        .footer-buttons {
            display: flex; gap: 10px; justify-content: center; width: 100%;
        }

        /* å‘¼å¸å‹•ç•«å®šç¾© */
        @keyframes pulse-btn {
            0% { transform: scale(1); box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 4px 12px rgba(255, 107, 107, 0.5); }
            100% { transform: scale(1); box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3); }
        }

        .share-btn-footer, .support-btn-footer {
            background-color: var(--line-color); color: white; border: none;
            padding: 8px 20px; border-radius: 20px; font-size: 0.9rem; font-weight: bold;
            cursor: pointer; display: flex; align-items: center; gap: 5px;
            box-shadow: 0 2px 8px rgba(6, 199, 85, 0.3);
            transition: all 0.2s;
        }
        .support-btn-footer {
            background-color: #ff6b6b; 
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
            /* å¥—ç”¨å‘¼å¸å‹•ç•«: 2ç§’ä¸€æ¬¡ï¼Œç„¡é™å¾ªç’° */
            animation: pulse-btn 2s infinite ease-in-out;
        }
        /* æ»‘é¼ ç§»ä¸Šå»æ™‚æš«åœå‹•ç•«ï¼Œé¿å…å¹²æ“¾ */
        .support-btn-footer:hover {
            animation: none;
            transform: scale(1.05);
        }

        .footer-credit { color: #888; font-size: 0.9rem; }
        .footer-credit a { color: #888; text-decoration: underline; transition: color 0.2s; }
        .footer-credit a:hover { color: var(--primary-color); }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: opacity 0.3s;
            backdrop-filter: blur(2px);
        }
        .overlay.show { opacity: 1; visibility: visible; }
        
        .modal-card {
            background: white; width: 85%; max-width: 320px;
            border-radius: 20px; padding: 25px 20px; text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); position: relative;
        }

        .modal-title { font-size: 1.5rem; font-weight: bold; color: var(--primary-color); margin-bottom: 10px; }
        .modal-text { font-size: 1.1rem; color: #333; margin-bottom: 25px; line-height: 1.5; }
        .guide-gif { width: 100%; border-radius: 10px; border: 2px solid #eee; margin-bottom: 15px; }

        .modal-btn-group { display: flex; flex-direction: column; gap: 10px; }
        
        .btn-main { background: var(--primary-color); color: white; border: none; padding: 12px; border-radius: 50px; font-size: 1.1rem; font-weight: bold; cursor: pointer; width: 100%; }
        .btn-line { background: var(--line-color); color: white; border: none; padding: 12px; border-radius: 50px; font-size: 1.0rem; font-weight: bold; cursor: pointer; width: 100%; }
        .btn-cancel { background: #f1f2f6; color: #7f8fa6; border: none; padding: 12px; border-radius: 50px; font-size: 1rem; font-weight: bold; cursor: pointer; width: 100%; }

        .ios-share-icon { font-size: 1.5rem; vertical-align: middle; margin: 0 5px; color: #007aff; }

        /* è´ŠåŠ© Modal ç‰¹æœ‰æ¨£å¼ */
        #supportModal.show { opacity: 1; visibility: visible; }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .support-modal-content { animation: popIn 0.3s ease-out; background: white; width: 90%; max-width: 380px; padding: 25px; border-radius: 16px; position: relative; }
        .support-close { position: absolute; top: 15px; right: 20px; font-size: 28px; cursor: pointer; color: #aaa; line-height: 20px; }
        .support-box { border-radius: 12px; padding: 15px; margin-bottom: 12px; border: 1px solid #eee; text-align: center; }

    </style>
</head>
<body>

    <h1>ğŸ“ ç¾é£Ÿé›·é” V3.5</h1>
    <div class="subtitle">Google Map æ™ºæ…§å¿«æœ</div>

    <div class="mode-switch">
        <button class="mode-btn active-meal" id="btn-meal" onclick="switchMode('meal')">ğŸ± æ‰¾æ­£é¤</button>
        <button class="mode-btn" id="btn-drink" onclick="switchMode('drink')">ğŸ§‹ ä¸‹åˆèŒ¶</button>
        <button class="mode-btn" id="btn-special" onclick="switchMode('special')">âœ¨ ç‰¹æ®Š</button>
    </div>

    <div class="section-title">1. ç”¨é¤æƒ…å¢ƒ</div>
    <div class="grid-container scenarios" id="scenario-container">
        <button class="option-btn selected" data-keyword="" onclick="selectScenario(this)"><span class="icon">ğŸ´</span>éš¨ä¾¿åƒåƒ</button>
        <button class="option-btn" data-keyword="é©åˆå–®äºº" onclick="selectScenario(this)"><span class="icon">ğŸ‘¤</span>1äººç¨äº«</button>
        <button class="option-btn" data-keyword="æ°£æ°›" onclick="selectScenario(this)"><span class="icon">ğŸ‘¥</span>2äººç´„æœƒ</button>
        <button class="option-btn" data-keyword="èšé¤" onclick="selectScenario(this)"><span class="icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>å¤šäººèšé¤</button>
    </div>

    <div class="section-title" id="type-title">2. æƒ³åƒä»€éº¼ï¼Ÿ</div>
    <div class="grid-container" id="cuisine-container"></div>

    <div id="special-notice">
        æœ¬å€â€œç‰¹æ®Šâ€é¡åˆ¥æœå°‹å¾Œ<br>
        è‡ªè¡Œç¢ºèªç¬¦åˆéœ€æ±‚å†å‰å¾€æ¶ˆè²»å–”
    </div>

    <div class="action-area">
        <button id="search-btn" class="action-btn" onclick="goSearch()">
            ğŸ” æœå°‹
        </button>
        <button id="random-btn" class="action-btn" onclick="goRandom()">
            ğŸ² å¹«æˆ‘é¸
        </button>
    </div>

    <div class="counter-box">
        å·²æœ‰ <span id="busuanzi_value_site_pv">...</span> äººäº«ç”¨ç¾é£Ÿäº†
    </div>

    <div class="footer">
        <div class="footer-buttons">
            <button class="share-btn-footer" onclick="shareToFriend('general')">
                ğŸ’¬ æ¨è–¦æœ‹å‹
            </button>
            <button class="support-btn-footer" onclick="openSupportModal()">
                â˜• æ”¯æŒä½œè€…
            </button>
        </div>
        <div class="footer-credit">
            <a href="https://www.threads.net/@freddychen1225" target="_blank">Freddy</a> & Gemini 3 Pro è¨­è¨ˆå”ä½œ
        </div>
    </div>

    <!-- PWA å®‰è£æ•™å­¸ Modal -->
    <div id="android-guide" class="overlay" onclick="this.classList.remove('show')">
        <div class="modal-card">
            <div class="modal-title">ğŸ‰ å®‰è£æˆåŠŸï¼</div>
            <div class="modal-text" style="margin-bottom:15px;">è«‹ä¾ç…§ä¸‹æ–¹å‹•ç•«ï¼Œå°‡åœ–ç¤ºåŠ åˆ°æ¡Œé¢</div>
            <img src="install-guide.gif" alt="å®‰è£æ•™å­¸" class="guide-gif">
            <button class="btn-main" onclick="document.getElementById('android-guide').classList.remove('show')">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>

    <div id="ios-guide" class="overlay">
        <div class="modal-card">
            <div class="modal-title">ğŸ˜‹ é¤“è‚šå­ä¸èƒ½ç­‰ï¼</div>
            <div class="modal-text" style="text-align: left; font-size: 1rem;">
                æŠŠé›·é”åŠ åˆ°æ¡Œé¢ï¼Œä¸‹æ¬¡è‚šå­é¤“æ™‚ï¼Œæ¯”åˆ¥äºº<b>å¿« 10 ç§’</b>æ‰¾åˆ°åƒçš„ï¼<br><br>
                1. é»æ“Šç€è¦½å™¨ä¸‹æ–¹çš„ <span class="ios-share-icon">ğŸ“¤</span> åˆ†äº«æŒ‰éˆ•<br>
                2. å¾€ä¸‹æ»‘æ‰¾åˆ°ã€ŒåŠ å…¥ä¸»ç•«é¢ã€<span class="ios-share-icon">â•</span><br>
                3. é»æ“Šå³ä¸Šè§’ã€ŒåŠ å…¥ã€
            </div>
            <button class="btn-main" onclick="closeIOSGuide()">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>

    <!-- éš¨æ©Ÿçµæœ Modal -->
    <div id="random-result-modal" class="overlay">
        <div class="modal-card">
            <div class="modal-title">âœ¨ å‘½é‹çš„é¸æ“‡ âœ¨</div>
            <div class="modal-text" id="random-result-text" style="font-size: 1.3rem; font-weight: bold; color: #333; margin: 20px 0;">
                ç‰›è‚‰éºµ
            </div>
            <div class="modal-btn-group">
                <button class="btn-main" id="btn-go-random">ğŸš€ å‡ºç™¼ï¼</button>
                <button class="btn-line" id="btn-share-random">ğŸ’¬ å‚³ LINE è§£æ•‘æœ‹å‹</button>
                <button class="btn-cancel" onclick="document.getElementById('random-result-modal').classList.remove('show')">å†è½‰ä¸€æ¬¡</button>
            </div>
        </div>
    </div>

    <!-- è´ŠåŠ© Modal (V3.5 æ›´æ–°ç‰ˆ) -->
    <div id="supportModal" class="overlay">
        <div class="support-modal-content">
            <div class="support-close" onclick="closeSupportModal()">&times;</div>
            <h3 style="margin: 5px 0 10px; color: #333; text-align: center;">æ”¯æŒç¾é£Ÿé›·é” ğŸ¯</h3>
            
            <!-- åƒ¹ç›®è¡¨ -->
            <div style="background: #fff8e1; border-radius: 10px; padding: 12px; margin-bottom: 15px; border: 1px solid #ffe082;">
                <p style="text-align: center; color: #f57c00; font-weight: bold; margin: 0 0 8px; font-size: 14px;">
                    ğŸ‘‡ è«‹é¸æ“‡æ‚¨æƒ³è´ŠåŠ©çš„å¿ƒæ„ ğŸ‘‡
                </p>
                <div style="display: flex; justify-content: space-between; gap: 5px; font-size: 13px; color: #555;">
                    <div style="flex: 1; text-align: center; background: white; padding: 8px 2px; border-radius: 6px; border: 1px solid #eee;">
                        ğŸµ é’èŒ¶<br><strong style="color: #ff6b6b; font-size: 15px;">$30</strong>
                    </div>
                    <div style="flex: 1; text-align: center; background: white; padding: 8px 2px; border-radius: 6px; border: 2px solid #ff6b6b; position: relative;">
                        <span style="position: absolute; top: -8px; right: -5px; background: #ff6b6b; color: white; font-size: 10px; padding: 2px 5px; border-radius: 10px;">æ¨è–¦</span>
                        ğŸ± æ»·è‚‰é£¯<br><strong style="color: #ff6b6b; font-size: 15px;">$60</strong>
                    </div>
                    <div style="flex: 1; text-align: center; background: white; padding: 8px 2px; border-radius: 6px; border: 1px solid #eee;">
                        ğŸš€ åŠ é€Ÿ<br><strong style="color: #ff6b6b; font-size: 15px;">$100</strong>
                    </div>
                </div>
                <p style="font-size: 11px; color: #999; text-align: center; margin: 8px 0 0;">
                    ç•¶ç„¶ï¼Œä»»ä½•é‡‘é¡éƒ½æ˜¯å·¨å¤§çš„é¼“å‹µï¼â¤ï¸
                </p>
            </div>

            <!-- 1. è¡—å£æ”¯ä»˜ -->
            <div class="support-box" style="background: #FFF0F0; border-color: #FFD0D0;">
                <div style="font-weight: bold; color: #D02020; margin-bottom: 8px; font-size: 15px;">è¡—å£æ”¯ä»˜ JKOPay</div>
                
                <a id="jkoLink" href="#" style="text-decoration: none;">
                    <button style="width: 100%; background: #E63838; color: white; border: none; padding: 12px; border-radius: 8px; font-size: 15px; cursor: pointer; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 5px;">
                        <span>ğŸš€ é–‹å•Ÿè¡—å£ APP è´ŠåŠ©</span>
                    </button>
                </a>
                
                <div style="font-size: 13px; color: #888; margin-top: 10px;">
                    <span id="qrHint" style="font-weight: bold; color: #d02020;">[ è«‹æ‰“é–‹è¡—å£æ”¯ä»˜æƒæ ]</span><br>
                    <img src="images/jko_qr.jpg" alt="è¡—å£QR Code" style="width: 140px; margin-top: 8px; border-radius: 8px; border: 1px solid #eee;">

                    <!-- å°æé†’ -->
                    <div style="font-size: 12px; color: #999; margin-top: 6px; line-height: 1.4;">
                      æ‰‹æ©Ÿå¯æˆªåœ–å­˜è‡³ç›¸ç°¿<br>å†ç”±è¡—å£ APP æ‰“é–‹æƒæè®€å–ç…§ç‰‡
                    </div>
                </div>
            </div>

            <!-- 2. éŠ€è¡Œè½‰å¸³ -->
            <div class="support-box" style="background: #F0F7FF; border-color: #D0E0FF;">
                <div style="font-weight: bold; color: #0066CC; margin-bottom: 8px; font-size: 15px;">éŠ€è¡Œè½‰å¸³</div>
                
                <div style="background: white; padding: 10px; border-radius: 6px; border: 1px dashed #B0C4DE; text-align: left; margin-bottom: 8px;">
                    <div style="font-size: 14px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 5px;">
                        éŠ€è¡Œä»£ç¢¼è«‹é¸ï¼š<strong style="color: #d63031; font-size: 16px;">108 é™½ä¿¡éŠ€è¡Œ</strong>
                    </div>
                    
                    <div style="font-size: 12px; color: #666; margin-top: 4px;">éŠ€è¡Œå¸³è™Ÿï¼š</div>
                    <div id="bankAccount" style="font-size: 18px; font-weight: bold; color: #333; letter-spacing: 1px; font-family: monospace;">036027500401</div>
                </div>
                
                <button onclick="copyAccount()" style="width: 100%; background: #0066CC; color: white; border: none; padding: 10px; border-radius: 8px; font-size: 14px; cursor: pointer; font-weight: bold;">
                    ğŸ“‹ è¤‡è£½å¸³è™Ÿ
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- è´ŠåŠ©åŠŸèƒ½è³‡æ–™è¨­å®š ---
        const myTwqrString = "TWQRP%3a%2f%2f%e5%80%8b%e4%ba%ba%e8%bd%89%e5%b8%b3%2f158%2f02%2fV1%3fD5%3d396%26D6%3d0000000900615072%26D10%3d901%26D97%3d20251212151945%26D98%3d39601527998570300000001%26D99%3dABA414E1";
        
        const mealCategories = [
            { name: "ç‰›è‚‰éºµ", icon: "ğŸœ" }, { name: "ä¾¿ç•¶ç°¡é¤", icon: "ğŸ±" }, { name: "å°åƒ/éºµåº—", icon: "ğŸ¢" },
            { name: "æ»·å‘³", icon: "ğŸ¥˜" }, { name: "æ°´é¤ƒ/é‹è²¼", icon: "ğŸ¥Ÿ" }, { name: "ç«é‹", icon: "ğŸ²" },
            { name: "éµæ¿ç‡’", icon: "ğŸ‘¨â€ğŸ³" }, { name: "ç‰›æ’", icon: "ğŸ¥©" }, { name: "ç¾©å¤§åˆ©éºµ", icon: "ğŸ" },
            { name: "æ¼¢å ¡/é€Ÿé£Ÿ", icon: "ğŸ”" }, { name: "æ—¥å¼æ–™ç†", icon: "ğŸ£" }, { name: "éŸ“å¼æ–™ç†", icon: "ğŸ¥˜" },
            { name: "æ³°å¼æ–™ç†", icon: "ğŸŒ¶ï¸" }, { name: "å’–å“©", icon: "ğŸ›" }, { name: "æ—©åˆé¤", icon: "ğŸ¥ª" }
        ];
        const drinkCategories = [
            { name: "æ‰‹æ–é£²", icon: "ğŸ§‹" }, { name: "å’–å•¡å»³", icon: "â˜•" }, { name: "ç‚¸é›/é¹½é…¥é›", icon: "ğŸ—" },
            { name: "è‡­è±†è…", icon: "ğŸ‘ƒ" }, { name: "éºµç·š", icon: "ğŸœ" }, { name: "è»Šè¼ªé¤…", icon: "ğŸ¥" },
            { name: "é›è›‹ç³•", icon: "ğŸ¥š" }, { name: "è”¥æ²¹é¤…/æŠ“é¤…", icon: "ğŸŒ¯" }, { name: "ç”œé»", icon: "ğŸ°" },
            { name: "å†°å“", icon: "ğŸ§" }, { name: "éºµåŒ…", icon: "ğŸ" }, { name: "ç”œç”œåœˆ", icon: "ğŸ©" }, { name: "ç« é­šç‡’", icon: "ğŸ™" }
        ];
        const specialCategories = [
            { name: "ç´ é£Ÿ", icon: "ğŸ¥¬" }, { name: "è¦ªå­é¤å»³", icon: "ğŸ‘¶" }, { name: "å¯µç‰©å‹å–„é¤å»³", icon: "ğŸ¶" }
        ];

        let currentMode = 'meal'; 
        let selectedScenarioKeyword = "";
        let selectedCuisineKeyword = "";

        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isPWA = window.matchMedia('(display-mode: standalone)').matches || (window.navigator.standalone === true);
        const SHARE_URL = "https://freddychen1225.github.io/food-radar/?openExternalBrowser=1";

        document.addEventListener('DOMContentLoaded', function() {
            renderCuisines(mealCategories);
            
            // è™•ç†è¡—å£é€£çµé‚è¼¯
            const jkoLink = document.getElementById('jkoLink');
            
            // ä¸€å¾‹éš±è—æŒ‰éˆ•ï¼Œåªç”¨æƒç¢¼
            if (jkoLink) {
               jkoLink.style.display = 'none';
            }
            
            window.addEventListener('appinstalled', (evt) => {
                if (/Android/i.test(navigator.userAgent)) {
                    document.getElementById('android-guide').classList.add('show');
                }
            });

            checkIOSGuide();
        });

        function checkIOSGuide() {
            if (isIOS && !isPWA && !localStorage.getItem('iosGuideShown')) {
                let count = parseInt(localStorage.getItem('searchCount') || '0');
                if (count >= 3) {
                    setTimeout(() => { document.getElementById('ios-guide').classList.add('show'); }, 1000);
                }
            }
        }

        function closeIOSGuide() {
            document.getElementById('ios-guide').classList.remove('show');
            localStorage.setItem('iosGuideShown', 'true');
        }

        // --- è´ŠåŠ© Modal ç›¸é—œåŠŸèƒ½ ---
        function openSupportModal() {
            document.getElementById('supportModal').classList.add('show');
        }
        function closeSupportModal() {
            document.getElementById('supportModal').classList.remove('show');
        }
        function copyAccount() {
            // è«‹ç¢ºä¿é€™è£¡çš„ ID å°æ‡‰åˆ°éŠ€è¡Œå¸³è™Ÿçš„å…ƒç´ 
            const text = document.getElementById("bankAccount").innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert("âœ… å¸³è™Ÿå·²è¤‡è£½ï¼\nè«‹æ‰“é–‹ç¶²éŠ€ App æˆ– LINE Pay é€²è¡Œè½‰å¸³");
            }).catch(err => {
                alert("âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹é•·æŒ‰å¸³è™Ÿæ‰‹å‹•è¤‡è£½");
            });
        }
        // é»æ“ŠèƒŒæ™¯é—œé–‰ Modal
        document.getElementById('supportModal').onclick = function(e) {
            if (e.target === this) closeSupportModal();
        }

        // --- åˆ†äº«åŠŸèƒ½ (å«ç¢ºèªé è¦½) ---
        function shareToFriend(type, foodName = "") {
            let text = "";
            let confirmMsg = "";

            if (type === 'general') {
                text = `ç™¼ç¾ä¸€å€‹è¶…å¥½ç”¨çš„æ‰¾ç¾é£Ÿå·¥å…·ï¼ä¸ç”¨ä¸‹è¼‰ Appï¼Œæ‰“é–‹å°±èƒ½ç”¨ï¼Œå°ˆæ²»é¸æ“‡å›°é›£ç—‡ï¼ğŸ’ŠğŸ”\n\n${SHARE_URL}`;
                confirmMsg = `æ‚¨å³å°‡å‚³é€ä»¥ä¸‹è¨Šæ¯çµ¦æœ‹å‹ï¼š\n\nã€Œç™¼ç¾ä¸€å€‹è¶…å¥½ç”¨çš„æ‰¾ç¾é£Ÿå·¥å…·ï¼...ã€\n\nç¢ºå®šè¦é–‹å•Ÿ LINE å—ï¼Ÿ`;
            } else if (type === 'random') {
                text = `æ•‘æ˜Ÿä¾†äº†ï¼å‘½é‹æ±ºå®šåƒã€Œ${foodName}ã€ï¼ä»¥å¾Œåƒé£¯ä¸ç”¨å†å•åƒä»€éº¼ï¼Œç›´æ¥ç”¨é€™å€‹ç¥å™¨è½‰ä¸€ä¸‹ï¼ğŸ±âœ¨\n\n${SHARE_URL}`;
                confirmMsg = `æ‚¨å³å°‡å‚³é€ä»¥ä¸‹è¨Šæ¯çµ¦æœ‹å‹ï¼š\n\nã€Œæ•‘æ˜Ÿä¾†äº†ï¼å‘½é‹æ±ºå®šåƒ ${foodName}ï¼...ã€\n\nç¢ºå®šè¦é–‹å•Ÿ LINE å—ï¼Ÿ`;
            }

            if (confirm(confirmMsg)) {
                const lineUrl = `https://line.me/R/msg/text/?${encodeURIComponent(text)}`;
                window.location.href = lineUrl;
            }
        }

        function switchMode(mode) {
            currentMode = mode;
            const btnMeal = document.getElementById('btn-meal');
            const btnDrink = document.getElementById('btn-drink');
            const btnSpecial = document.getElementById('btn-special');
            const body = document.body;

            btnMeal.className = 'mode-btn'; btnDrink.className = 'mode-btn'; btnSpecial.className = 'mode-btn';
            body.classList.remove('drink-mode', 'special-mode');

            if (mode === 'meal') {
                btnMeal.className = 'mode-btn active-meal'; renderCuisines(mealCategories);
            } else if (mode === 'drink') {
                btnDrink.className = 'mode-btn active-drink'; body.classList.add('drink-mode'); renderCuisines(drinkCategories);
            } else if (mode === 'special') {
                btnSpecial.className = 'mode-btn active-special'; body.classList.add('special-mode'); renderCuisines(specialCategories);
            }
            selectedCuisineKeyword = "";
        }

        function renderCuisines(list) {
            const container = document.getElementById('cuisine-container');
            container.innerHTML = ""; 

            list.forEach(item => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `<span class="icon">${item.icon}</span>${item.name}`;
                btn.dataset.name = item.name; 
                
                btn.addEventListener('click', function() {
                    const allBtns = container.querySelectorAll('.option-btn');
                    allBtns.forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedCuisineKeyword = item.name;
                });
                container.appendChild(btn);
            });
        }

        function selectScenario(btn) {
            const container = document.getElementById('scenario-container');
            const allBtns = container.querySelectorAll('.option-btn');
            allBtns.forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedScenarioKeyword = btn.getAttribute('data-keyword');
        }

        function goSearch() {
            if (!selectedCuisineKeyword) {
                let typeName = "æ­£é¤";
                if(currentMode === 'drink') typeName = "é»å¿ƒ";
                if(currentMode === 'special') typeName = "ç‰¹æ®Šéœ€æ±‚";
                const randomHint = currentMode === 'special' ? "" : "ï¼Œæˆ–æŒ‰ã€ŒğŸ² å¹«æˆ‘é¸ã€";
                alert(`è«‹å…ˆé¸æ“‡${typeName}é¡å‹${randomHint}ï¼`);
                return;
            }
            performSearch(selectedCuisineKeyword);
        }

        function goRandom() {
            if(currentMode === 'special') return;
            const container = document.getElementById('cuisine-container');
            const options = container.querySelectorAll('.option-btn');
            const randomIndex = Math.floor(Math.random() * options.length);
            const selectedBtn = options[randomIndex];
            const keyword = selectedBtn.dataset.name;

            const allBtns = container.querySelectorAll('.option-btn');
            allBtns.forEach(b => b.classList.remove('selected'));
            selectedBtn.classList.add('selected');
            selectedCuisineKeyword = keyword;

            setTimeout(() => {
                const modal = document.getElementById('random-result-modal');
                document.getElementById('random-result-text').innerText = keyword;
                
                document.getElementById('btn-go-random').onclick = function() {
                    modal.classList.remove('show');
                    performSearch(keyword);
                };
                document.getElementById('btn-share-random').onclick = function() {
                    shareToFriend('random', keyword);
                };
                
                modal.classList.add('show');
            }, 100);
        }

        function performSearch(keyword) {
            let count = parseInt(localStorage.getItem('searchCount') || '0');
            localStorage.setItem('searchCount', count + 1);

            let query = keyword;
            if (selectedScenarioKeyword) { query += " " + selectedScenarioKeyword; }
            const mapUrl = `https://www.google.com/maps/search/${encodeURIComponent(query)}`;
            
            if (isIOS && isPWA) {
                window.location.href = mapUrl;
            } else {
                window.open(mapUrl, '_blank');
            }
        }
    </script>
</body>
</html>
